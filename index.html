<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Nim Invenc√≠vel</title>
    <style>
        :root { --primary: #00f2ff; --bg: #0d0d0d; --danger: #ff0055; }
        body { font-family: sans-serif; background: var(--bg); color: white; text-align: center; padding: 20px; }
        
        #learning-bar-container { width: 250px; height: 8px; background: #222; margin: 10px auto; border-radius: 4px; }
        #learning-bar { width: 0%; height: 100%; background: var(--primary); transition: width 0.5s; box-shadow: 0 0 10px var(--primary); }

        .board { display: flex; justify-content: center; gap: 10px; margin: 30px 0; flex-wrap: wrap; }
        .cell { 
            width: 50px; height: 50px; border: 2px solid #333; display: flex; 
            align-items: center; justify-content: center; border-radius: 8px; 
            font-weight: bold; transition: 0.3s; background: rgba(255,255,255,0.05);
        }
        .cell.active { background: var(--primary); color: #000; box-shadow: 0 0 20px var(--primary); transform: scale(1.1); }
        .cell.nim-active { background: var(--danger); box-shadow: 0 0 20px var(--danger); }

        button { 
            padding: 15px 25px; font-size: 1rem; border-radius: 30px; border: 2px solid var(--primary);
            background: transparent; color: white; cursor: pointer; margin: 5px; transition: 0.2s;
        }
        button:hover:not(:disabled) { background: var(--primary); color: black; }
        button:disabled { border-color: #444; color: #444; cursor: not-allowed; opacity: 0.5; }
        
        #message { margin-top: 20px; font-size: 1.2rem; min-height: 1.5em; color: #aaa; }
    </style>
</head>
<body>

    <h1>DR. NIM</h1>
    <div id="learning-bar-container"><div id="learning-bar"></div></div>
    <small id="intel-text">INTELIG√äNCIA: APRENDENDO</small>

    <div class="board" id="board"></div>

    <div class="controls">
        <button id="btn1" onclick="handleMove(1)">Avan√ßar 1</button>
        <button id="btn2" onclick="handleMove(2)">Avan√ßar 2</button>
    </div>

    <p id="message">Sua vez, humano.</p>

    <script>
        let currentPos = 0;
        const target = 9;
        let gamesPlayed = 0;
        let isNimThinking = false;

        function initBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            for (let i = 1; i <= target; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `c-${i}`;
                cell.innerHTML = i === target ? 'üíé' : i;
                board.appendChild(cell);
            }
            updateButtons();
        }

        function updateUI(isNim = false) {
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('active', 'nim-active'));
            if (currentPos > 0) {
                const activeCell = document.getElementById(`c-${currentPos}`);
                if (activeCell) {
                    activeCell.classList.add('active');
                    if (isNim) activeCell.classList.add('nim-active');
                }
            }
            
            // Atualiza barra de "Intelig√™ncia"
            const intel = Math.min(gamesPlayed * 34, 100);
            document.getElementById('learning-bar').style.width = intel + "%";
            document.getElementById('intel-text').innerText = gamesPlayed >= 2 ? "INTELIG√äNCIA: INVENC√çVEL" : "INTELIG√äNCIA: APRENDENDO";
            
            updateButtons();
        }

        function updateButtons() {
            const b1 = document.getElementById('btn1');
            const b2 = document.getElementById('btn2');

            if (isNimThinking || currentPos >= target) {
                b1.disabled = true;
                b2.disabled = true;
            } else {
                b1.disabled = (currentPos + 1 > target);
                b2.disabled = (currentPos + 2 > target);
            }
        }

        function handleMove(steps) {
            if (isNimThinking) return;

            currentPos += steps;
            updateUI();

            if (currentPos === target) {
                endGame("Voc√™ venceu! Dr. Nim est√° processando o erro...", true);
                return;
            }

            isNimThinking = true;
            updateButtons();
            document.getElementById('message').innerText = "Dr. Nim pensando...";
            
            setTimeout(drNimMove, 1000);
        }

        function drNimMove() {
            let move;

            if (gamesPlayed < 2) {
                // Modo inicial: ele erra de prop√≥sito
                move = (currentPos + 2 === target) ? 1 : (currentPos + 1 === target ? 2 : Math.floor(Math.random() * 2) + 1);
            } else {
                // MODO INVENC√çVEL: Matem√°tica modular (M√∫ltiplos de 3)
                move = (currentPos % 3 === 0) ? 1 : (3 - (currentPos % 3));
            }

            // Seguran√ßa para n√£o passar de 9
            if (currentPos + move > target) move = 1;

            currentPos += move;
            updateUI(true);

            if (currentPos === target) {
                endGame("DR. NIM VENCEU! 'Eu j√° decifrei seu padr√£o.'", false);
            } else {
                isNimThinking = false;
                document.getElementById('message').innerText = "Sua vez.";
                updateButtons();
            }
        }

        function endGame(msg, playerWon) {
            document.getElementById('message').innerText = msg;
            gamesPlayed++;
            isNimThinking = true;
            updateButtons();
            setTimeout(resetGame, 3000);
        }

        function resetGame() {
            currentPos = 0;
            isNimThinking = false;
            initBoard();
            updateUI();
            document.getElementById('message').innerText = "Nova rodada. Pode come√ßar.";
        }

        // Rodar ao carregar
        initBoard();
    </script>
</body>
</html>