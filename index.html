<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desafio Dr. Nim - IA Training</title>
    <style>
        :root { --neon-blue: #00f2ff; --neon-pink: #ff0055; --bg: #0a0a0c; }
        body { font-family: 'Courier New', Courier, monospace; background: var(--bg); color: #fff; text-align: center; padding: 10px; }
        .container { max-width: 600px; margin: 0 auto; border: 1px solid #333; padding: 20px; border-radius: 15px; background: rgba(0,0,0,0.8); }
        
        /* Placar */
        .scoreboard { display: flex; justify-content: space-around; font-size: 1.5rem; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .score { color: var(--neon-blue); font-weight: bold; }

        /* Tabuleiro */
        .board { display: flex; justify-content: center; gap: 8px; margin: 30px 0; }
        .cell { width: 45px; height: 45px; border: 1px solid #444; display: flex; align-items: center; justify-content: center; border-radius: 5px; font-size: 0.9rem; transition: 0.3s; }
        .cell.active { background: var(--neon-blue); color: #000; box-shadow: 0 0 15px var(--neon-blue); transform: translateY(-5px); }
        .cell.nim { background: var(--neon-pink); box-shadow: 0 0 15px var(--neon-pink); }
        .diamond { border-color: var(--neon-blue); font-size: 1.5rem; }

        /* Mensagens */
        #console { height: 80px; margin: 20px 0; color: #00ff00; font-size: 0.9rem; line-height: 1.4; overflow-y: auto; text-align: left; background: #000; padding: 10px; border-radius: 5px; }
        
        button { padding: 15px 25px; background: transparent; color: white; border: 1px solid var(--neon-blue); cursor: pointer; border-radius: 5px; margin: 5px; font-family: inherit; }
        button:hover:not(:disabled) { background: var(--neon-blue); color: black; }
        button:disabled { opacity: 0.2; border-color: #444; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="scoreboard">
        <div>Humano: <span id="player-score" class="score">0</span></div>
        <div>Dr. Nim: <span id="nim-score" class="score">0</span></div>
    </div>

    <div id="intel-tag" style="font-size: 0.7rem; color: #888; margin-bottom: 10px;">FASE: TREINAMENTO DOS NEUR√îNIOS</div>

    <div class="board" id="board"></div>

    <div id="controls">
        <button id="btn1" onclick="playerAction(1)">Pegar 1</button>
        <button id="btn2" onclick="playerAction(2)">Pegar 2</button>
    </div>

    <div id="console">> Sistema inicializado. Aguardando input...</div>
    
    <button id="btn-reveal" class="hidden" onclick="revealSecret()" style="border-color: gold; color: gold;">REVELAR SEGREDO MATEM√ÅTICO</button>
</div>

<script>
    let pos = 0;
    const target = 9;
    let pScore = parseInt(localStorage.getItem('nim_pScore')) || 0;
    let nScore = parseInt(localStorage.getItem('nim_nScore')) || 0;
    let totalMatches = pScore + nScore;
    let isThinking = false;

    function init() {
        const board = document.getElementById('board');
        board.innerHTML = '';
        for (let i = 1; i <= target; i++) {
            const c = document.createElement('div');
            c.className = 'cell' + (i === target ? ' diamond' : '');
            c.id = `c-${i}`;
            c.innerHTML = i === target ? 'üíé' : '‚óè';
            board.appendChild(c);
        }
        updateStatus();
    }

    function updateStatus() {
        document.getElementById('player-score').innerText = pScore;
        document.getElementById('nim-score').innerText = nScore;
        
        const isTrained = (totalMatches >= 3); // Ap√≥s 3 partidas, vira determin√≠stico
        document.getElementById('intel-tag').innerText = isTrained ? "ALGORITMO: DETERMIN√çSTICO (TREINADO)" : "ALGORITMO: APRENDIZAGEM DE M√ÅQUINA";
        
        document.getElementById('btn1').disabled = (pos + 1 > target || isThinking);
        document.getElementById('btn2').disabled = (pos + 2 > target || isThinking);

        if (pScore >= 4 || nScore >= 4) {
            announceSeriesWinner();
        }
    }

    function playerAction(n) {
        pos += n;
        renderPos(false);
        if (pos === target) return win(true);
        
        isThinking = true;
        updateStatus();
        log("Operadores de neur√¥nios agindo...");
        setTimeout(nimAction, 1000);
    }

    function nimAction() {
        let move;
        const isTrained = (totalMatches >= 2);

        if (isTrained) {
            // L√≥gica Exata: Complementar para somar 3
            move = (pos % 3 === 0) ? 1 : (3 - (pos % 3));
        } else {
            // Fase de Treino: Pode errar
            move = Math.floor(Math.random() * 2) + 1;
            if (pos + move === target && totalMatches < 1) move = (move === 1 ? 2 : 1);
        }

        if (pos + move > target) move = 1;
        pos += move;
        renderPos(true);
        
        if (pos === target) return win(false);
        
        isThinking = false;
        log("Dr. Nim moveu. Sua vez, desafiante!");
        updateStatus();
    }

    function renderPos(isNim) {
        document.querySelectorAll('.cell').forEach(c => c.classList.remove('active', 'nim'));
        const active = document.getElementById(`c-${pos}`);
        active.classList.add('active');
        if (isNim) active.classList.add('nim');
    }

    function win(isPlayer) {
        if (isPlayer) {
            pScore++;
            log("VOC√ä GANHOU! 'O Dr. Nim vai castigar seus servi√ßais e fazer 20 rodadas de treino!'");
        } else {
            nScore++;
            log("DR. NIM GANHOU! Conhecimento adquirido aplicado com sucesso.");
        }
        totalMatches++;
        localStorage.setItem('nim_pScore', pScore);
        localStorage.setItem('nim_nScore', nScore);
        
        setTimeout(() => {
            pos = 0;
            init();
            isThinking = false;
        }, 2500);
    }

    function announceSeriesWinner() {
        document.getElementById('controls').classList.add('hidden');
        document.getElementById('btn-reveal').classList.remove('hidden');
        const winner = pScore >= 4 ? "HUMANO" : "DR. NIM";
        log(`MELHOR DE SETE ENCERRADA! Vencedor: ${winner}. Placar: ${pScore} a ${nScore}.`);
    }

    function revealSecret() {
        alert("O SEGREDO DO DR. NIM:\n\nAgrupe as pe√ßas em 3 segmentos de 3.\nSe o desafiante pega 1, o Dr. Nim pega 2.\nSe o desafiante pega 2, o Dr. Nim pega 1.\nA m√°quina busca sempre totalizar 3 por rodada, deixando voc√™ sempre a 3 pe√ßas do diamante!");
        log("Padr√£o revelado: Heur√≠stica ensina que a soma 3 √© invenc√≠vel.");
    }

    function log(m) {
        const c = document.getElementById('console');
        c.innerHTML = "> " + m + "<br>" + c.innerHTML;
    }

    init();
</script>
</body>
</html>